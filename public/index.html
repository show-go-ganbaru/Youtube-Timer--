<!doctype html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube Timer</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;margin:20px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:16px}
  .card{border:1px solid #ddd;border-radius:12px;padding:12px}
  img{width:100%;border-radius:8px}
  .meta{color:#555;font-size:14px;margin:6px 0}
  input,button{font-size:16px;padding:10px;border-radius:10px;border:1px solid #ccc}
  button{cursor:pointer}
</style>
<body>
  <h1>YouTube Timer</h1>
  <p>指定秒数に近い動画を返します</p>
  <div>
    <input id="sec" type="number" min="1" placeholder="例: 300" />
    <select id="mode">
      <option value="popular">popular</option>
      <option value="related">related</option>
      <option value="window">window</option>
    </select>
    <button id="go">Search</button>
  </div>
  <div id="status" class="meta"></div>
  <div class="grid" id="grid"></div>

<script>
  // "http://localhost:5000/?seconds=300&mode=related"
  const API_BASE = "https://YOUR-BACKEND-URL/api";

  document.getElementById("go").onclick = async () => {
    const sec = Number(document.getElementById("sec").value);
    const mode = document.getElementById("mode").value;
    const status = document.getElementById("status");
    const grid = document.getElementById("grid");

    if (!sec || sec <= 0) { alert("秒数を入れて"); return; }

    status.textContent = "検索中...";
    grid.innerHTML = "";
    try {
      const r = await fetch(`${API_BASE}?seconds=${sec}&mode=${mode}`);
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error || "API error");
      status.textContent = `ターゲット: ${j.target_duration_seconds} 秒 / mode: ${j.mode}`;
      grid.innerHTML = j.closest_videos.map(v => `
        <div class="card">
          <a href="${v.url}" target="_blank" rel="noopener">
            <img src="${v.thumbnail || ""}" alt="">
          </a>
          <div><strong>${v.title}</strong></div>
          <div class="meta">${v.channel || ""}</div>
          <div class="meta">長さ: ${v.duration_seconds}s / 差分: ${v.difference_seconds}s</div>
          <a href="${v.url}" target="_blank" rel="noopener">YouTubeで開く</a>
        </div>
      `).join("");
    } catch (e) {
      status.textContent = "エラー: " + e.message;
    }
  };
</script>
</body>
</html>
